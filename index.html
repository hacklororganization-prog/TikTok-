<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙŠÙƒ ØªÙˆÙƒ ØªÙˆÙ†Ø³ - Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #00f2ff; --accent: #ff0050; --gold: #ffcc00; --bg: #0a0d14; --card: #161b26; --text: #fff; --success: #00ff9d; --error: #ff4757; --warning: #ffaa00; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); overflow-x: hidden; }
        .screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .logo { font-size: 2.5rem; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; color: transparent; margin-bottom: 10px; }
        .welcome-message { color: #b0b8cc; margin-bottom: 20px; }
        .name-input { width: 100%; max-width: 300px; padding: 15px; border-radius: 12px; background: #1e2433; border: 1px solid #333; color: white; margin-bottom: 15px; text-align: center; font-size: 1rem; outline: none; }
        .name-input:focus { border-color: var(--primary); }
        .warning-note { background: rgba(255, 170, 0, 0.1); color: var(--warning); padding: 10px; border-radius: 8px; margin-top: 10px; max-width: 300px; font-size: 0.8rem; }
        .app-container { max-width: 500px; margin: 0 auto; padding: 15px; display: none; }
        header, .task-card, .leaderboard-section, .daily-prize { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .user-info h2 { color: var(--primary); font-size: 1.4rem; }
        .user-status { color: var(--success); font-size: 0.8rem; }
        .points-display { background: rgba(255,204,0,0.1); padding: 10px; border-radius: 15px; border: 1px solid var(--gold); text-align: center; }
        .points-display .points { color: var(--gold); font-size: 1.5rem; font-weight: 900; }
        .daily-prize { border: 2px solid var(--gold); text-align: center; }
        .prize-header { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .prize-header i { color: var(--gold); font-size: 1.5rem; }
        .prize-header h3 { color: var(--gold); font-size: 1.3rem; }
        .day-info { background: rgba(0, 242, 255, 0.1); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .day-info .day { color: var(--primary); font-weight: 700; }
        .prize-amount { color: var(--success); font-size: 1.8rem; font-weight: 900; margin: 10px 0; }
        .contest-number { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; margin: 10px 0; border: 1px dashed var(--primary); }
        .prize-instructions { background: rgba(255, 170, 0, 0.1); padding: 10px; border-radius: 8px; margin: 15px 0; font-size: 0.9rem; }
        .tasks-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .tasks-progress { background: rgba(0, 242, 255, 0.1); padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; color: var(--primary); }
        .task-card { display: flex; align-items: center; justify-content: space-between; border-right: 5px solid var(--accent); transition: all 0.3s; }
        .task-card.completed { border-right-color: var(--success); opacity: 0.7; }
        .task-info { display: flex; align-items: center; gap: 10px; }
        .task-icon { width: 40px; height: 40px; border-radius: 10px; background: rgba(0, 242, 255, 0.1); display: flex; align-items: center; justify-content: center; color: var(--primary); }
        .task-details h4 { font-size: 0.95rem; margin-bottom: 3px; }
        .task-points { color: var(--gold); font-weight: 700; font-size: 0.85rem; }
        .task-hint { font-size: 0.8rem; color: #b0b8cc; }
        .btn { padding: 10px 20px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-success { background: var(--success); color: #000; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-small { padding: 8px 15px; font-size: 0.9rem; }
        .leaderboard-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .leaderboard-header i { color: var(--gold); }
        .leaderboard-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .leaderboard-item:last-child { border-bottom: none; }
        .leaderboard-rank { width: 35px; height: 35px; border-radius: 8px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; font-weight: 700; margin-left: 10px; }
        .rank-1 { background: linear-gradient(135deg, #FFD700, #FFAA00); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #CD7F32, #A0522D); color: #000; }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-weight: 700; }
        .leaderboard-name.you { color: var(--primary); }
        .leaderboard-status { font-size: 0.75rem; color: #b0b8cc; }
        .leaderboard-points { color: var(--gold); font-weight: 800; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; display: none; align-items: center; justify-content: center; padding: 15px; }
        .modal-box { background: var(--card); border-radius: 20px; padding: 25px; width: 100%; max-width: 400px; border: 2px solid var(--primary); text-align: center; }
        .modal-icon { font-size: 3rem; color: var(--primary); margin-bottom: 15px; }
        .modal-title { font-size: 1.3rem; margin-bottom: 10px; color: var(--primary); }
        .modal-text { color: #b0b8cc; margin-bottom: 20px; }
        .verification-hint { background: rgba(255, 170, 0, 0.1); padding: 12px; border-radius: 8px; margin: 15px 0; text-align: right; }
        .code-input { width: 100%; padding: 15px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); color: white; font-size: 1.1rem; text-align: center; outline: none; margin: 15px 0; }
        .code-input:focus { border-color: var(--primary); }
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden; margin: 15px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.1s linear; }
        .timer-display { font-size: 1.8rem; font-weight: 900; color: var(--gold); margin: 10px 0; }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; z-index: 10001; }
        .toast { background: var(--card); padding: 15px; border-radius: 10px; margin-top: 10px; border-right: 4px solid var(--primary); display: flex; align-items: center; gap: 10px; animation: slideUp 0.3s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .toast-success { border-right-color: var(--success); }
        .toast-error { border-right-color: var(--error); }
        .app-footer { text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); }
        .save-status { color: var(--primary); font-size: 0.75rem; }
        @media (max-width: 480px) {
            .logo { font-size: 2rem; }
            .app-container { padding: 10px; }
            .task-card { flex-direction: column; gap: 10px; text-align: center; }
            .task-info { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>

<div id="welcome-screen" class="screen">
    <div class="logo">ØªÙŠÙƒ ØªÙˆÙƒ ØªÙˆÙ†Ø³</div>
    <div class="welcome-message">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
    <input type="text" id="user-name" class="name-input" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" maxlength="20">
    <button onclick="login()" class="btn btn-primary" style="width: 250px; padding: 15px;">
        <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„
    </button>
    <div class="warning-note"><i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø§Ø³Ù… Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</div>
</div>

<div class="app-container" id="main-app">
    <header style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 id="name-tag">Ø²Ø§Ø¦Ø±</h2>
            <div class="user-status"><i class="fas fa-circle" style="font-size: 0.6rem;"></i> Ù…ØªØµÙ„</div>
        </div>
        <div class="points-display">
            <div class="points" id="points-count">0</div>
            <div>Ù†Ù‚Ø·Ø©</div>
        </div>
    </header>

    <div class="daily-prize">
        <div class="prize-header">
            <i class="fas fa-gift"></i>
            <h3>Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
        </div>
        <div class="day-info">
            <div class="day" id="day-name">Ø§Ù„ÙŠÙˆÙ…: Ø§Ù„Ø£Ø­Ø¯</div>
        </div>
        <div class="prize-amount" id="prize-amount">0 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="contest-number">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©: <span id="contest-number">85700</span></div>
        <div class="prize-instructions"><i class="fas fa-info-circle"></i> Ø§Ù„ÙØ§Ø¦Ø² ÙŠØ®ØªØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹</div>
        <button onclick="checkIfWinner()" class="btn btn-gold" style="width: 100%;" id="check-winner-btn">
            <i class="fas fa-trophy"></i> ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙØ²Øª
        </button>
    </div>

    <div class="tasks-header">
        <h3><i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
        <div class="tasks-progress" id="tasks-progress">0/5 Ù…ÙƒØªÙ…Ù„Ø©</div>
    </div>
    <div id="tasks-container"></div>

    <div class="leaderboard-section">
        <div class="leaderboard-header">
            <i class="fas fa-trophy"></i>
            <h3>Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
        </div>
        <div id="leaderboard-list"></div>
    </div>

    <div class="app-footer">
        <div style="color: #888; font-size: 0.8rem;">Â© ØªÙŠÙƒ ØªÙˆÙƒ ØªÙˆÙ†Ø³</div>
        <div class="save-status" id="last-save">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: --:--</div>
    </div>
</div>

<div class="modal-overlay" id="verify-modal">
    <div class="modal-box">
        <div class="modal-icon"><i class="fas fa-user-check"></i></div>
        <div class="modal-title" id="modal-task-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù‡Ù…Ø©</div>
        <div class="modal-text" id="modal-task-description">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</div>
        <div class="verification-hint" id="verification-hint">
            <i class="fas fa-key"></i>
            <span>Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx</span>
        </div>
        <input type="text" class="code-input" id="verification-code-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (5 Ø£Ø±Ù‚Ø§Ù…)" maxlength="5">
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <div class="timer-display" id="v-timer">30</div>
        <button onclick="verifyTaskWithCode()" class="btn btn-success" style="width: 100%;">
            <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯
        </button>
        <button onclick="closeVerificationModal()" class="btn" style="width: 100%; margin-top: 10px; background: rgba(255,255,255,0.1);">
            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
    </div>
</div>

<div class="modal-overlay" id="winner-modal" style="display: none;">
    <div class="modal-box">
        <div class="modal-icon"><i class="fas fa-trophy" style="color: var(--gold);"></i></div>
        <div class="modal-title" style="color: var(--gold);">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</div>
        <div class="modal-text" id="winner-message">ÙØ²Øª Ø¨Ù€ 500,000 Ø¯ÙŠÙ†Ø§Ø±!</div>
        <div class="verification-hint"><i class="fas fa-info-circle"></i> Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ØªØ±Ø³Ù„ Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©</div>
        <button onclick="closeWinnerModal()" class="btn btn-gold" style="width: 100%;">
            <i class="fas fa-gift"></i> ØªÙ…
        </button>
    </div>
</div>

<div class="modal-overlay" id="not-winner-modal" style="display: none;">
    <div class="modal-box">
        <div class="modal-icon"><i class="fas fa-times-circle" style="color: var(--error);"></i></div>
        <div class="modal-title" style="color: var(--error);">Ø¹Ø°Ø±Ø§Ù‹</div>
        <div class="modal-text">Ù„Ù… ØªÙØ² Ø§Ù„ÙŠÙˆÙ…ØŒ Ø­Ø§ÙˆÙ„ ØºØ¯Ø§Ù‹</div>
        <div class="verification-hint"><i class="fas fa-lightbulb"></i> Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµÙƒ</div>
        <button onclick="closeNotWinnerModal()" class="btn btn-primary" style="width: 100%;">
            <i class="fas fa-redo"></i> Ø­Ø§ÙˆÙ„ ØºØ¯Ø§Ù‹
        </button>
    </div>
</div>

<div id="toast-container"></div>

<script>

// app.js - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„

const TIKTOK_URL = "https://www.tiktok.com/@bldaxx?is_from_webapp=1&sender_device=pc";
const VERIFICATION_CODE = "11221";
const SHARE_TEXT = "Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙŠÙƒ ØªÙˆÙƒ ØªÙˆÙ†Ø³! Ø´Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù†: https://bit.ly/tt-tunisia #ØªÙŠÙƒ_ØªÙˆÙƒ_ØªÙˆÙ†Ø³";

const ARABIC_DAYS = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];

const TASKS = [
    { id: "follow", title: "Ù…ØªØ§Ø¨Ø¹Ø© @bldaxx", description: "ØªØ§Ø¨Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨", points: 1500, icon: "fas fa-user-plus", hint: "Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx", url: TIKTOK_URL },
    { id: "like", title: "Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª", description: "Ø£Ø¹Ø¬Ø¨ Ø¨Ù€ 3 ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª", points: 1000, icon: "fas fa-heart", hint: "Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx", url: TIKTOK_URL },
    { id: "comment", title: "ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ", description: "Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹", points: 1200, icon: "fas fa-comment", hint: "Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx", url: TIKTOK_URL },
    { id: "share_whatsapp", title: "Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨", description: "Ø´Ø§Ø±Ùƒ Ù…Ø¹ 3 Ø£ØµØ¯Ù‚Ø§Ø¡", points: 800, icon: "fab fa-whatsapp", hint: "Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx", url: `https://wa.me/?text=${encodeURIComponent(SHARE_TEXT)}` },
    { id: "share_instagram", title: "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù†Ø³ØªØºØ±Ø§Ù…", description: "Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø·", points: 700, icon: "fab fa-instagram", hint: "Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø§ÙŠÙˆ (Ø§Ù„ÙˆØµÙ) Ù„Ø­Ø³Ø§Ø¨ @bldaxx", url: "https://www.instagram.com/" }
];

const FAKE_LEADERS = [
    { name: "Ø£Ø­Ù…Ø¯ Ø§Ù„ÙØ§Ø¦Ø²", points: 2850000, status: "Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", fake: true },
    { name: "Ø³Ø§Ø±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©", points: 2180000, status: "Ø§Ù„Ø¨Ø·Ù„Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©", fake: true },
    { name: "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø·Ù„", points: 1950000, status: "Ù†Ø´Ø·", fake: true },
    { name: "ÙØ§Ø·Ù…Ø© Ø§Ù„Ù…Ø¨Ø¯Ø¹Ø©", points: 1760000, status: "ØªØ­Ø¯ÙŠ", fake: true },
    { name: "Ø¹Ù„ÙŠ Ø§Ù„Ù…Ù†Ø§ÙØ³", points: 1580000, status: "ÙŠØ³Ø¹Ù‰ Ù„Ù„ÙÙˆØ²", fake: true }
];

let userData = {
    name: "",
    points: 0,
    completedTasks: [],
    dailyPrizes: {},
    stats: { totalTasks: 0, dailyTasks: 0, lastLogin: null, registrationDate: null },
    verification: { currentTask: null, attempts: 0 }
};

function initApp() {
    loadUserData();
    updateUI();
    startAutoSave();
    updateTime();
    setInterval(updateTime, 60000);
}

function loadUserData() {
    try {
        const saved = localStorage.getItem('tiktok_tunisia_user');
        if (saved) {
            const data = JSON.parse(saved);
            const today = getTodayString();
            if (!data.dailyPrizes || !data.dailyPrizes[today]) {
                data.dailyPrizes = data.dailyPrizes || {};
                data.dailyPrizes[today] = { claimed: false, amount: generateDailyPrize(), date: new Date().toISOString() };
            }
            userData = data;
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${userData.name}!`, 'success');
            return true;
        }
    } catch (e) {
        console.error('Ø®Ø·Ø£:', e);
    }
    return false;
}

function login() {
    const nameInput = document.getElementById('user-name');
    const name = nameInput.value.trim();
    
    if (!name || name.length < 3) {
        showToast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­ (3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)', 'error');
        nameInput.focus();
        return;
    }
    
    if (!userData.name || userData.name !== name) {
        userData = {
            name: name,
            points: 0,
            completedTasks: [],
            dailyPrizes: {},
            stats: { totalTasks: 0, dailyTasks: 0, lastLogin: new Date().toISOString(), registrationDate: new Date().toISOString() },
            verification: { currentTask: null, attempts: 0 }
        };
        const today = getTodayString();
        userData.dailyPrizes[today] = { claimed: false, amount: generateDailyPrize(), date: new Date().toISOString() };
    }
    
    saveUserData();
    document.getElementById('welcome-screen').style.display = 'none';
    document.getElementById('main-app').style.display = 'block';
    updateUI();
    showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userData.name}!`, 'success');
}

function saveUserData() {
    try {
        userData.stats.lastLogin = new Date().toISOString();
        localStorage.setItem('tiktok_tunisia_user', JSON.stringify(userData));
        const now = new Date();
        const timeStr = now.toLocaleTimeString('ar-TN', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('last-save').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeStr}`;
        return true;
    } catch (e) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', e);
        return false;
    }
}

function generateDailyPrize() {
    const min = 50000;
    const max = 1000000;
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function getTodayString() {
    const date = new Date();
    return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
}

function updateUI() {
    document.getElementById('name-tag').textContent = userData.name;
    document.getElementById('points-count').textContent = userData.points.toLocaleString('ar-TN');
    updateDailyPrizeUI();
    updateTasksUI();
    updateLeaderboardUI();
}

function updateDailyPrizeUI() {
    const today = getTodayString();
    const todayPrize = userData.dailyPrizes[today];
    const dayName = ARABIC_DAYS[new Date().getDay()];
    
    document.getElementById('day-name').textContent = `Ø§Ù„ÙŠÙˆÙ…: ${dayName}`;
    
    if (todayPrize) {
        document.getElementById('prize-amount').textContent = `${todayPrize.amount.toLocaleString('ar-TN')} Ø¯ÙŠÙ†Ø§Ø±`;
        
        const claimBtn = document.getElementById('check-winner-btn');
        if (todayPrize.claimed) {
            claimBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠÙˆÙ…';
            claimBtn.disabled = true;
            claimBtn.className = 'btn';
            claimBtn.style.background = '#555';
        } else {
            const canCheck = userData.completedTasks.length >= 2;
            claimBtn.disabled = !canCheck;
            claimBtn.className = canCheck ? 'btn btn-gold' : 'btn';
            claimBtn.style.background = canCheck ? '' : '#555';
            claimBtn.innerHTML = canCheck ? 
                '<i class="fas fa-trophy"></i> ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙØ²Øª' :
                '<i class="fas fa-lock"></i> Ø£ÙƒÙ…Ù„ Ù…Ù‡Ù…ØªÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹';
        }
    }
    
    const contestNum = 85700 + new Date().getDate();
    document.getElementById('contest-number').textContent = contestNum;
}

function updateTasksUI() {
    const container = document.getElementById('tasks-container');
    const completedCount = userData.completedTasks.length;
    
    document.getElementById('tasks-progress').textContent = `${completedCount}/${TASKS.length} Ù…ÙƒØªÙ…Ù„Ø©`;
    
    container.innerHTML = TASKS.map(task => {
        const isCompleted = userData.completedTasks.includes(task.id);
        
        return `
            <div class="task-card ${isCompleted ? 'completed' : ''}">
                <div class="task-info">
                    <div class="task-icon">
                        <i class="${task.icon}"></i>
                    </div>
                    <div class="task-details">
                        <h4>${task.title}</h4>
                        <div class="task-points">+${task.points.toLocaleString('ar-TN')} Ù†Ù‚Ø·Ø©</div>
                        <div class="task-hint">${task.hint}</div>
                    </div>
                </div>
                <button onclick="startTask('${task.id}')" class="btn ${isCompleted ? '' : 'btn-primary'} btn-small" ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? '<i class="fas fa-check"></i>' : '<i class="fas fa-play"></i>'}
                </button>
            </div>
        `;
    }).join('');
}

function startTask(taskId) {
    const task = TASKS.find(t => t.id === taskId);
    if (!task) return;
    
    userData.verification.currentTask = taskId;
    userData.verification.attempts = 0;
    saveUserData();
    
    window.open(task.url, '_blank');
    
    setTimeout(() => showVerificationModal(task), 1000);
}

function showVerificationModal(task) {
    const modal = document.getElementById('verify-modal');
    document.getElementById('modal-task-title').textContent = task.title;
    document.getElementById('modal-task-description').textContent = task.description;
    document.getElementById('verification-hint').innerHTML = `<i class="fas fa-key"></i><span>${task.hint}</span>`;
    
    const codeInput = document.getElementById('verification-code-input');
    codeInput.value = '';
    codeInput.focus();
    
    modal.style.display = 'flex';
    
    let timeLeft = 30;
    const timerElement = document.getElementById('v-timer');
    const progressElement = document.getElementById('progress-fill');
    
    const timer = setInterval(() => {
        timeLeft--;
        timerElement.textContent = timeLeft;
        progressElement.style.width = `${((30 - timeLeft) / 30) * 100}%`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            closeVerificationModal();
            showToast('Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØ­Ù‚Ù‚', 'warning');
        }
    }, 1000);
    
    modal._timer = timer;
}

function closeVerificationModal() {
    const modal = document.getElementById('verify-modal');
    modal.style.display = 'none';
    
    if (modal._timer) {
        clearInterval(modal._timer);
    }
    
    userData.verification.currentTask = null;
    saveUserData();
}

function verifyTaskWithCode() {
    const codeInput = document.getElementById('verification-code-input');
    const enteredCode = codeInput.value.trim();
    
    if (!enteredCode) {
        showToast('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚', 'error');
        codeInput.focus();
        return;
    }
    
    if (!userData.verification.currentTask) {
        showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ù…Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚', 'error');
        return;
    }
    
    const task = TASKS.find(t => t.id === userData.verification.currentTask);
    if (!task) return;
    
    userData.verification.attempts++;
    
    if (enteredCode === VERIFICATION_CODE) {
        if (userData.completedTasks.includes(task.id)) {
            showToast('Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©', 'warning');
            closeVerificationModal();
            return;
        }
        
        userData.completedTasks.push(task.id);
        userData.points += task.points;
        userData.stats.totalTasks++;
        userData.stats.dailyTasks++;
        
        closeVerificationModal();
        saveUserData();
        updateUI();
        
        showToast(`ØªÙ…! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${task.points.toLocaleString('ar-TN')} Ù†Ù‚Ø·Ø©`, 'success');
        
    } else {
        if (userData.verification.attempts >= 3) {
            showToast('ØªØ¬Ø§ÙˆØ²Øª Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª', 'error');
            closeVerificationModal();
        } else {
            const remaining = 3 - userData.verification.attempts;
            showToast(`ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦. Ø¨Ø§Ù‚ÙŠ ${remaining} Ù…Ø­Ø§ÙˆÙ„Ø©${remaining > 1 ? 'Ø§Øª' : ''}`, 'error');
            codeInput.value = '';
            codeInput.focus();
        }
        saveUserData();
    }
}

function checkIfWinner() {
    const today = getTodayString();
    const todayPrize = userData.dailyPrizes[today];
    
    if (!todayPrize) {
        showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙŠÙˆÙ…', 'error');
        return;
    }
    
    if (todayPrize.claimed) {
        showToast('Ù„Ù‚Ø¯ ØªØ­Ù‚Ù‚Øª Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
        return;
    }
    
    if (userData.completedTasks.length < 2) {
        showToast('Ø£ÙƒÙ…Ù„ Ù…Ù‡Ù…ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
        return;
    }
    
    // Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„ÙÙˆØ² 5% ÙÙ‚Ø·
    const isWinner = Math.random() < 0.05;
    
    todayPrize.claimed = true;
    todayPrize.claimedAt = new Date().toISOString();
    
    saveUserData();
    updateUI();
    
    if (isWinner) {
        document.getElementById('winner-message').innerHTML = `ÙØ²Øª Ø¨Ù€ <span style="color: var(--gold);">${todayPrize.amount.toLocaleString('ar-TN')} Ø¯ÙŠÙ†Ø§Ø±</span>!`;
        document.getElementById('winner-modal').style.display = 'flex';
        showToast('ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ²! ğŸ‰', 'success');
    } else {
        document.getElementById('not-winner-modal').style.display = 'flex';
        showToast('Ù„Ù… ØªÙØ² Ø§Ù„ÙŠÙˆÙ…ØŒ Ø­Ø§ÙˆÙ„ ØºØ¯Ø§Ù‹', 'info');
    }
}

function closeWinnerModal() {
    document.getElementById('winner-modal').style.display = 'none';
}

function closeNotWinnerModal() {
    document.getElementById('not-winner-modal').style.display = 'none';
}

function updateLeaderboardUI() {
    const listElement = document.getElementById('leaderboard-list');
    const allLeaders = [...FAKE_LEADERS];
    
    allLeaders.push({
        name: userData.name,
        points: userData.points,
        status: "Ø£Ù†Øª",
        fake: false
    });
    
    allLeaders.sort((a, b) => {
        if (a.fake && !b.fake) return -1;
        if (!a.fake && b.fake) return 1;
        return b.points - a.points;
    });
    
    const displayLeaders = allLeaders.slice(0, 5);
    
    listElement.innerHTML = displayLeaders.map((leader, index) => {
        const rank = index + 1;
        const isYou = leader.name === userData.name;
        
        return `
            <div class="leaderboard-item">
                <div class="leaderboard-rank ${rank <= 3 ? `rank-${rank}` : ''}">
                    ${rank}
                </div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name ${isYou ? 'you' : ''}">
                        ${leader.name}${isYou ? ' (Ø£Ù†Øª)' : ''}
                    </div>
                    <div class="leaderboard-status">
                        ${leader.status}
                    </div>
                </div>
                <div class="leaderboard-points">
                    ${leader.points.toLocaleString('ar-TN')}
                </div>
            </div>
        `;
    }).join('');
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    
    const icons = { success: 'fas fa-check-circle', error: 'fas fa-exclamation-circle', warning: 'fas fa-exclamation-triangle', info: 'fas fa-info-circle' };
    
    toast.innerHTML = `<i class="${icons[type]}"></i><span>${message}</span>`;
    
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('ar-TN', { hour: '2-digit', minute: '2-digit' });
    document.getElementById('user-status-text').textContent = `Ù…ØªØµÙ„ - ${timeStr}`;
}

function startAutoSave() {
    setInterval(() => {
        if (userData.name) {
            saveUserData();
        }
    }, 30000);
}

window.addEventListener('beforeunload', () => {
    if (userData.name) {
        saveUserData();
    }
});

window.onload = initApp;

</script>
</body>
</html>